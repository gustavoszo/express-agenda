<%- include('includes/header') %>
<%- include('includes/nav') %>

<main>
  <div class="container">

    <div class="col-8 offset-2">
        <h1 class="text-center my-3">Agenda</h1>
        <p class="text-center lead my-3">Confira abaixo os seus contatos</p>
        
        <%- include('includes/alert') %>
        
        <% if(contatos.length > 0) { %>
          <a class="btn btn-primary" href="/contatos/create"><i class="fas fa-plus"></i> Novo contato</a>
          <table class="table mt-4">
            <% contatos.forEach(contato => { %>
            <tr>
              <td><%= contato.firstname %></td>
              <td><%= contato.lastname %></td>
              <td><%= contato.email %></td>
              <td><%= contato.phone %></td>
              <td><a href="/contatos/<%= contato._id %>/edit">Editar</a></td>
              <td>
                <form action="/contatos/delete/<%= contato._id %>" method="post" class="delete-form">
                  <input type="hidden" name="_csrf" value="<%- csrfToken %>"> 
                  <button type="submit" class="text-danger" style="border: none; background: none;">Apagar</button>
                </form>
              </td>
            </tr>
          <% }) %>
          </table>
        <% } else { %>
          <p class="text-center lead mt-5">Você ainda não tem contatos.</p>
        <% } %>

        
    </div>

  </div>    
</main>

<script>
  document.querySelectorAll('form.delete-form').forEach(form => {
    form.addEventListener('submit', function(e) {
      if (!confirm('Deseja realmente apagar o contato?')) {
        e.preventDefault(); // Cancela o envio do formulário se o usuário não confirmar
      }
    });
  });
</script>

<%- include('includes/footer') %>